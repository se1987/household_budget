# 家計簿アプリ テスト設計書

本設計書は、家計簿アプリ API のテストケースを定義します。各エンドポイントに対して、適切なリクエストを送信し、期待されるレスポンスやエラーメッセージを確認します。

## 1. テスト対象

| リソース     | 説明                   |
| ------------ | ---------------------- |
| categories   | 費目に関する情報       |
| transactions | 収入・支出に関する情報 |

## 2. テストケース一覧

| テストケース ID | テスト項目                            | HTTP メソッド | エンドポイント      | 期待されるレスポンス      |
| --------------- | ------------------------------------- | ------------- | ------------------- | ------------------------- |
| TC01            | すべての収入・支出情報を取得          | GET           | `/transactions`     | 200 OK                    |
| TC02            | 特定の収入・支出情報を取得            | GET           | `/transactions/:id` | 200 OK                    |
| TC03            | 新規収入・支出を作成                  | POST          | `/transactions`     | 201 Created               |
| TC04            | 特定の収入・支出を更新                | PUT           | `/transactions/:id` | 200 OK                    |
| TC05            | 特定の収入・支出を削除                | DELETE        | `/transactions/:id` | 204 No Content            |
| TC06            | すべての費目情報を取得                | GET           | `/categories`       | 200 OK                    |
| TC07            | 特定の費目情報を取得                  | GET           | `/categories/:id`   | 200 OK                    |
| TC08            | 新規費目を作成                        | POST          | `/categories`       | 201 Created               |
| TC09            | 特定の費目を削除                      | DELETE        | `/categories/:id`   | 204 No Content            |
| TC10            | 不正なリクエストで 400 エラーを確認   | POST          | `/transactions`     | 400 Bad Request           |
| TC11            | 存在しないリソースで 404 エラーを確認 | GET           | `/transactions/:id` | 404 Not Found             |
| TC12            | サーバーエラー時の 500 エラーを確認   | POST          | `/transactions`     | 500 Internal Server Error |

## 3. 各テストケースの詳細

### TC01 すべての収入・支出情報を取得

**テスト目的**: すべての取引データが正常に取得できるか確認する。  
**HTTP メソッド**: GET  
**エンドポイント**: `/transactions`  
**リクエストボディ**: なし  
**期待されるステータスコード**: 200 OK  
**期待されるレスポンスデータ**: `TransactionResponse[]`形式

### TC02 特定の収入・支出情報を取得

**テスト目的**: 特定の取引データが正常に取得できるか確認する。  
**HTTP メソッド**: GET  
**エンドポイント**: `/transactions/:id`  
**リクエストボディ**: なし  
**期待されるステータスコード**: 200 OK  
**期待されるレスポンスデータ**: `TransactionResponse`

### TC03 新規収入・支出を作成

**テスト目的**: 新規取引データが正常に作成できるか確認する。  
**HTTP メソッド**: POST  
**エンドポイント**: `/transactions`  
**リクエストボディ**:

```json
{
  "amount": 1000,
  "date": "2024-07-26T00:00:00.000Z",
  "type": "収入",
  "description": "ボーナス",
  "category": {
    "id": 1,
    "name": "給与"
  }
}
```

**期待されるステータスコード**: 201 Created  
**期待されるレスポンスデータ**: `TransactionResponse`

### TC04 特定の収入・支出を更新

**テスト目的**: 既存の取引データが正常に更新できるか確認する。  
**HTTP メソッド**: PUT  
**エンドポイント**: `/transactions/:id`  
**リクエストボディ**:

```json
{
  "amount": 1200,
  "date": "2024-08-01T00:00:00.000Z",
  "type": "収入",
  "description": "ボーナス増額",
  "category": {
    "id": 1,
    "name": "給与"
  }
}
```

**期待されるステータスコード**: 200 OK  
**期待されるレスポンスデータ**: `TransactionResponse`

### TC05 特定の収入・支出を削除

**テスト目的**: 既存の取引データが正常に削除できるか確認する。  
**HTTP メソッド**: DELETE  
**エンドポイント**: `/transactions/:id`  
**リクエストボディ**: なし  
**期待されるステータスコード**: 204 No Content

### TC06 すべての費目情報を取得

**テスト目的**: すべての費目データが正常に取得できるか確認する。  
**HTTP メソッド**: GET  
**エンドポイント**: `/categories`  
**リクエストボディ**: なし  
**期待されるステータスコード**: 200 OK  
**期待されるレスポンスデータ**: `CategoryResponse[]`

### TC07 特定の費目情報を取得

**テスト目的**: 特定の費目データが正常に取得できるか確認する。  
**HTTP メソッド**: GET  
**エンドポイント**: `/categories/:id`  
**リクエストボディ**: なし  
**期待されるステータスコード**: 200 OK  
**期待されるレスポンスデータ**: `CategoryResponse`

### TC08 新規費目を作成

**テスト目的**: 新規費目データが正常に作成できるか確認する。  
**HTTP メソッド**: POST  
**エンドポイント**: `/categories`  
**リクエストボディ**:

```json
{
  "name": "投資"
}
```

**期待されるステータスコード**: 201 Created  
**期待されるレスポンスデータ**: `CategoryResponse`

### TC09 特定の費目を削除

**テスト目的**: 既存の費目データが正常に削除できるか確認する。  
**HTTP メソッド**: DELETE  
**エンドポイント**: `/categories/:id`  
**リクエストボディ**: なし  
**期待されるステータスコード**: 204 No Content

### TC10 不正なリクエストで 400 エラーを確認

**テスト目的**: 不正なリクエストが送信された場合、正しく 400 エラーが返るかを確認する。  
**HTTP メソッド**: POST  
**エンドポイント**: `/transactions`  
**リクエストボディ**:

```json
{
  "amount": "invalid data"
}
```

**期待されるステータスコード**: 400 Bad Request

### TC11 存在しないリソースで 404 エラーを確認

**テスト目的**: 存在しないリソースに対してリクエストを送信した場合、正しく 404 エラーが返るかを確認する。  
**HTTP メソッド**: GET  
**エンドポイント**: `/transactions/99999`  
**リクエストボディ**: なし  
**期待されるステータスコード**: 404 Not Found

### TC12 サーバーエラー時の 500 エラーを確認（続き）

**期待されるレスポンスデータ**:

```json
{
  "error": "Internal Server Error"
}
```

---

## 4. テスト実施時の注意点

- **テスト環境**: 各 API エンドポイントのテストは、開発環境もしくはステージング環境で行うこと。  
  本番環境でのテストは行わない。
- **データ初期化**: 各テストケース実行前に、データベースの初期化を行い、テストデータの登録・削除が正確に行えるようにする。

- **タイムゾーン**: 日付・時間データを扱うテストケースでは、タイムゾーンの影響を受ける可能性があるため、システムのタイムゾーン設定を確認する。

---

## 5. テスト実行手順

1. **API クライアントの準備**: Postman や cURL を使用して、API リクエストを送信するためのクライアントを準備する。
2. **環境構築**: テスト実行前に、データベースが正しくセットアップされていることを確認し、API が起動していることを確認する。

3. **テストの実行**: 上記のテストケースに従い、各エンドポイントに対してリクエストを送信し、期待されるレスポンスを確認する。

4. **テスト結果の記録**: 各テストケースの結果を記録し、成功または失敗のステータスを確認する。必要に応じてエラーログを分析する。
